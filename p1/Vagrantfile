# -*- mode: ruby -*-
# vi: set ft=ruby :

SERVER_NAME = "ebouvierS"
SERVER_IP = "192.168.56.110"

SERVER_WORKER_NAME = "ebouvierSW"
SERVER_WORKER_IP = "192.168.56.111"

if (ARGV.include?("up") || ARGV.include?("reload") || ARGV.include?("provision")) && (ENV['TOKEN'].nil? || ENV['TOKEN'].empty?)
  raise "TOKEN environment var missing."
end

Vagrant.configure("2") do |config|
  config.vm.box = "generic/debian12"

  # Server
  config.vm.define SERVER_NAME do |s|
    s.vm.provider :virtualbox do |v|
      v.cpus = 2
      v.memory = 2048
      v.name = SERVER_NAME
    end
    s.vm.hostname = SERVER_NAME
    s.vm.network "private_network", ip: SERVER_IP

    s.vm.provision "shell" do |sh|
      sh.path = "scripts/server.sh"
      sh.args = [SERVER_IP.to_s, SERVER_NAME.to_s, ENV['TOKEN'].to_s]
    end
  end

  # ServerWorker
  config.vm.define SERVER_WORKER_NAME do |sw|
    sw.vm.provider :virtualbox do |v|
      v.cpus = 2
      v.memory = 2048
      v.name = SERVER_WORKER_NAME
    end
    sw.vm.hostname = SERVER_WORKER_NAME
    sw.vm.network "private_network", ip: SERVER_WORKER_IP

    sw.vm.provision "shell" do |sh|
      sh.path = "scripts/worker.sh"
      sh.args = [SERVER_IP.to_s, SERVER_WORKER_NAME.to_s, SERVER_WORKER_IP.to_s, ENV['TOKEN'].to_s]
    end
  end
end
